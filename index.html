<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>School Timetable — Per-Year View</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <h1>School Timetable Editor — Per-Year</h1>
    <div class="top-actions">
      <button id="btnAutoSchedule">Auto-schedule</button>
      <button id="btnClear">Clear assignments</button>
      <button id="btnResetData">Reset Teachers & Lessons</button>
      <button id="btnExportJSON">Export JSON</button>
      <button id="btnImportJSON">Import JSON</button>
      <button id="btnExportExcel">Export Excel (CSV)</button>
      <button id="btnExportCSV">Export Grid CSV</button>
      <button id="btnPrint">Print</button>
    </div>
  </header>

  <main>
    <aside class="panel" id="panelLeft">
      <section class="card">
        <h2>Settings</h2>
        <label>Working days:
          <select id="selectDays" multiple>
            <option value="Mon" selected>Mon</option>
            <option value="Tue" selected>Tue</option>
            <option value="Wed" selected>Wed</option>
            <option value="Thu" selected>Thu</option>
            <option value="Fri" selected>Fri</option>
            <option value="Sat">Sat</option>
            <option value="Sun">Sun</option>
          </select>
        </label>
        <label>Periods per day:
          <input id="inputPeriods" type="number" min="1" max="12" value="5" />
        </label>
        <div style="margin-top:8px">
          <button id="btnApplySettings">Apply</button>
        </div>
      </section>

      <section class="card">
        <h2>Years</h2>
        <div id="yearsList" class="small"></div>
        <div class="small" style="margin-top:6px">Click years to toggle selection (used by bulk generation & adding lessons).</div>
      </section>

      <section class="card">
        <h2>Subjects (per-week & merge)</h2>
        <div id="subjectsList" class="small"></div>
        <div style="margin-top:8px">
          <button id="btnAddSubject">Add Subject</button>
        </div>
      </section>

      <section class="card">
        <h2>Rooms</h2>
        <div id="roomsList" class="small"></div>
      </section>

      <section class="card">
        <h2>Teachers</h2>
        <div class="form-row">
          <input id="teacherFullName" placeholder="Full name (e.g. M Harrison)" />
          <button id="btnAddTeacher">Add</button>
        </div>
        <div id="teachersList" class="small"></div>
        <div class="small" style="margin-top:8px">Click Edit to modify availability instead of deleting.</div>
      </section>

      <section class="card" id="createLessonCard">
        <h2>Create Lesson (multi-year)</h2>

        <div class="form-row">
          <label style="width:100%">
            Years (click to select, Ctrl/Cmd or Shift for multi):
            <select id="lessonYear" multiple size="6" style="width:100%; margin-top:6px"></select>
          </label>
        </div>

        <div class="form-row">
          <label style="flex:1">
            Subject:
            <select id="lessonSubject" style="width:100%; margin-top:6px"></select>
          </label>
          <button id="btnEditSubject" title="Edit selected subject">Edit</button>
        </div>

        <div class="form-row">
          <label style="flex:1">
            Teacher:
            <select id="lessonTeacher" style="width:100%; margin-top:6px"></select>
          </label>
        </div>

        <div class="form-row">
          <label style="flex:1">
            Room:
            <select id="lessonRoom" style="width:100%; margin-top:6px"></select>
          </label>
        </div>

        <div class="form-row" style="align-items:center; gap:10px">
          <label style="display:flex;align-items:center;gap:8px">
            Count:
            <input id="lessonCount" type="number" min="1" value="1" style="width:80px; margin-left:6px"/>
          </label>

          <label style="display:flex;align-items:center;gap:8px; margin-left:auto">
            <input id="lessonMerged" type="checkbox" /> Merged (same slot across selected years)
          </label>
        </div>

        <!-- Full-width Add button so it's always clearly visible -->
        <div class="create-lesson-actions" style="margin-top:8px; display:flex;">
          <button id="btnAddLesson" class="primary-wide">Add Lesson(s)</button>
        </div>

        <div class="small" style="margin-top:8px">Values persist after adding to speed up bulk input.</div>
      </section>

    </aside>

    <section class="timetable-wrap">
      <div id="timetable" class="timetable"></div>

      <div class="bottom-panel">
        <section class="card small" id="filterPanel">
          <h3>Filters</h3>
          <div class="form-row">
            <select id="filterType">
              <option value="all">All Years</option>
              <option value="year">Per Year</option>
              <option value="teacher">Per Teacher</option>
              <option value="room">Per Room</option>
              <option value="subject">Per Subject</option>
              <option value="staff">Whole Teaching Staff</option>
            </select>
            <select id="filterValue" style="min-width:140px"></select>
            <button id="btnApplyFilter">Filter</button>
            <button id="btnClearFilter">Clear</button>
          </div>
          <div class="small">Select a filter type and value, then press Filter to apply.</div>
        </section>

        <section class="card" id="tokensPanel">
          <h3>Unassigned Lessons</h3>
          <div id="tokens" class="tokens"></div>
          <div class="small">Drag tokens to the correct year/day/slot, or click token then click a slot. Only year-matching or merged assignments are allowed.</div>
        </section>
      </div>
    </section>

  </main>

  <footer>
    <small>Local timetable editor · data stored in your browser. Customize as needed.</small>
  </footer>

  <input type="file" id="fileImport" accept="application/json" style="display:none" />

  <script src="app.js"></script>
</body>
</html>
